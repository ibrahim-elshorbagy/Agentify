import{r as u,u as G,j as t}from"./app-D3ko-qNy.js";import{A as B}from"./AppModal-Cjw6IsCb.js";import{I as k,a as N}from"./InputLabel-T1fq5YhO.js";import{T as y}from"./TextInput-DXWQbyvQ.js";import{P as F}from"./PrimaryButton-DxEv7cBr.js";import{S as J}from"./SecondaryButton-BGFOcamt.js";import{A as x}from"./ActionButton-8526TYZu.js";import{u as M}from"./useTrans-BkTq1qdy.js";function V({isOpen:n,onClose:p,initialSettings:c=null,source:d="gmail"}){const{t:a}=M(),[i,g]=u.useState(["09:00"]),[m,f]=u.useState(["09:00"]),[b,T]=u.useState(null),{data:O,setData:l,post:S,errors:h,processing:j}=G({email_agent_google_fetch_time:[],email_agent_outlook_fetch_time:[]});u.useEffect(()=>{n&&fetch(route("user.email-agent.server-time")).then(e=>e.json()).then(e=>{T(e)}).catch(e=>{console.error("Failed to fetch server time:",e)})},[n]);const v=e=>{if(typeof e=="string"&&e.match(/^\d{2}:\d{2}$/))return e;if(e&&typeof e=="object"){const{hour:s,minute:o,period:r}=e;let _=parseInt(s);return r==="pm"&&_!==12&&(_+=12),r==="am"&&_===12&&(_=0),`${_.toString().padStart(2,"0")}:${o.padStart(2,"0")}`}return"09:00"};u.useEffect(()=>{if(n)if(d==="gmail"){const e=c?.email_agent_google_fetch_time?JSON.parse(c.email_agent_google_fetch_time):["09:00"],s=Array.isArray(e)?e.map(v):["09:00"];g(s),l({email_agent_google_fetch_time:s,email_agent_outlook_fetch_time:[]})}else{const e=c?.email_agent_outlook_fetch_time?JSON.parse(c.email_agent_outlook_fetch_time):["09:00"],s=Array.isArray(e)?e.map(v):["09:00"];f(s),l({email_agent_google_fetch_time:[],email_agent_outlook_fetch_time:s})}},[c,n,d]);const w=()=>{const e=[...i,"09:00"];g(e),l("email_agent_google_fetch_time",e)},A=e=>{if(i.length>1){const s=i.filter((o,r)=>r!==e);g(s),l("email_agent_google_fetch_time",s)}},z=(e,s)=>{const o=[...i];o[e]=s,g(o),l("email_agent_google_fetch_time",o)},E=()=>{const e=[...m,"09:00"];f(e),l("email_agent_outlook_fetch_time",e)},C=e=>{if(m.length>1){const s=m.filter((o,r)=>r!==e);f(s),l("email_agent_outlook_fetch_time",s)}},I=(e,s)=>{const o=[...m];o[e]=s,f(o),l("email_agent_outlook_fetch_time",o)},$=e=>{e.preventDefault(),S(route("user.email-agent.schedule.update"),{onSuccess:()=>{p()}})};return t.jsxs(B,{isOpen:n,onClose:p,title:a(d==="gmail"?"google_fetch_times":"outlook_fetch_times"),icon:"fa-clock",size:"lg",children:[t.jsx("div",{className:"mb-4",children:t.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:a("schedule_description")})}),b&&t.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("i",{className:"fa-solid fa-server text-blue-600 dark:text-blue-400"}),t.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:a("server_time_info")})]}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("p",{className:"text-blue-800 dark:text-blue-200",children:[t.jsxs("span",{className:"font-medium",children:[a("current_server_time"),":"]})," ",b.server_time]}),t.jsxs("p",{className:"text-blue-800 dark:text-blue-200",children:[t.jsxs("span",{className:"font-medium",children:[a("server_timezone"),":"]})," ",b.server_timezone_name]}),t.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:[t.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),a("schedule_times_based_on_server")]})]})]}),t.jsxs("form",{onSubmit:$,children:[d==="gmail"&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx(k,{value:a("google_fetch_times")}),t.jsx(x,{type:"button",onClick:w,icon:"fa-plus",variant:"success",size:"xs",children:a("add_time")})]}),t.jsx("div",{className:"space-y-3",children:i.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-lg",children:[t.jsx("div",{className:"flex-1",children:t.jsx(y,{type:"time",name:`google_time_${s}`,value:e,onChange:o=>z(s,o.target.value),className:"text-sm"})}),i.length>1&&t.jsx(x,{type:"button",onClick:()=>A(s),icon:"fa-trash",variant:"delete",size:"xs",children:a("remove")})]},s))}),h.email_agent_google_fetch_time&&t.jsx(N,{message:h.email_agent_google_fetch_time,className:"mt-2"})]}),d==="outlook"&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx(k,{value:a("outlook_fetch_times")}),t.jsx(x,{type:"button",onClick:E,icon:"fa-plus",variant:"success",size:"xs",children:a("add_time")})]}),t.jsx("div",{className:"space-y-3",children:m.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-lg",children:[t.jsx("div",{className:"flex-1",children:t.jsx(y,{type:"time",name:`outlook_time_${s}`,value:e,onChange:o=>I(s,o.target.value),className:"text-sm"})}),m.length>1&&t.jsx(x,{type:"button",onClick:()=>C(s),icon:"fa-trash",variant:"delete",size:"xs",children:a("remove")})]},s))}),h.email_agent_outlook_fetch_time&&t.jsx(N,{message:h.email_agent_outlook_fetch_time,className:"mt-2"})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[t.jsx(J,{type:"button",onClick:p,icon:"fa-xmark",rounded:"rounded-lg",disabled:j,children:a("cancel")}),t.jsx(F,{type:"submit",icon:"fa-floppy-disk",rounded:"rounded-lg",withShadow:!1,disabled:j,children:a(j?"saving":"save")})]})]})]})}export{V as default};
